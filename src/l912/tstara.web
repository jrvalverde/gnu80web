@* tstara.
\section*{\sf Dummy Arguments}  \begin{description}
                                                                    
\item[PASSED:] IBUC1                                                     
\item[PASSED:] IBUC2                                                     
\item[PASSED:] C                                                         
\item[INPUT:] NO                                                        
\item[INPUT:] NV                                                        
\item[PASSED:] S                                                         
\item[INPUT:] INITW                                                     
\item[INPUT:] NBASIS                                                    
                                                                    
\end{description} \section*{\sf Common Variables}  \begin{description}
                                                                    
\item[Modifies]     NOTHING                                           
\item[Transmits as argument]  V                                                      
\item[Uses]  MDV     V                                              
                                                                    
\end{description}  \section*{\sf External Subprograms}  \begin{description}
                                                                    
\item[Calls]       CTWC1   FILEIO  TRACK                                  
\item[Called by]   DD1SD4                                                 
                                                                    
\end{description}
@a
      subroutine tstara(IBUC1,IBUC2,C,NO,NV,S,INITW,NBASIS)
      implicit none
      double precision C , S , V
      integer i , IBUC1 , IBUC2 , lbloc , leftb , leftwi , leftwo , 
     &        leng , Mdv , mdv11 , nb3 , NBASIS , nbloc , NO , no3 , 
     &        nr , NV , nv3 , nwi , nwo
      logical INITW
      dimension C(*) , S(*)
      common /v     / V(20000) , Mdv
C
C     ******************************************************************
C1tstara
C
C     performs the following transformation:
C     w(i,j,a,b) =  sum  c(mu,a) * c(nu,b) * w'(i,j,mu,nu)
C                  mu,nu
C     w' is taken from ibuc1
C     w is written on ibuc2
C
C     c is assumed to be in core
C     s is a scratch array of min. length nbasis
C     initw false: w is initialized
C     else:      : w is incremented
C     treats the spincases aa and bb
C
C
C     dec 76/seeger
C
C     ******************************************************************
C
C
      call track('TSTARA')
C
      no3 = NO*(NO-1)/2
      nv3 = NV*(NV-1)/2
      if ( no3.le.0 .or. nv3.le.0 ) return
      nb3 = NBASIS*(NBASIS-1)/2
C
C     compute allocations in v
      leftb = no3
      leftwi = nb3*no3
      leftwo = nv3*no3
      nbloc = Mdv/(nv3+nb3)
      nwi = nbloc*nb3
      nwo = nbloc*nv3
      nr = no3/nbloc
      if ( mod(no3,nbloc).ne.0 ) nr = nr + 1
      mdv11 = nwi + 1
C
      call fileio(2,-IBUC1,0,0,0)
      call fileio(2,-IBUC2,0,0,0)
      call fileio(1,-IBUC2,0,0,0)
C
C     loop over core-loads
      do 100 i = 1 , nr
         leng = min0(leftwi,nwi)
         leftwi = leftwi - leng
         call fileio(2,IBUC1,leng,V,0)
         leng = min0(leftwo,nwo)
         leftwo = leftwo - leng
         if ( INITW ) call fileio(2,IBUC2,leng,V(mdv11),0)
         lbloc = min0(leftb,nbloc)
         leftb = leftb - lbloc
         call ctwc1(V(mdv11),C,V,NV,lbloc,S,INITW,NBASIS)
         call fileio(1,IBUC2,leng,V(mdv11),0)
 100  continue
C
      return
C
      end
@* INDEX.
